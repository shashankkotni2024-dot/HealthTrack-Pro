<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthTrack Pro | Healthcare Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4a6fa5;
            --primary-light: #6b8cc0;
            --primary-dark: #3a5984;
            --secondary: #66bb6a;
            --secondary-light: #85d788;
            --secondary-dark: #4a9e4e;
            --warning: #ff9800;
            --warning-light: #ffb74d;
            --danger: #f44336;
            --danger-light: #ff7961;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 10px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
            padding-bottom: 80px; /* Space for mobile notification bar */
        }

        h1, h2, h3, h4 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.2rem;
        }

        .logo h1 {
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Notification Toggle Styles */
        .notification-toggle-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .notification-toggle-btn.enabled {
            background: rgba(102, 187, 106, 0.8); /* Green when on */
            box-shadow: 0 0 0 2px rgba(102, 187, 106, 0.3);
        }

        .notification-toggle-btn.disabled {
            background: rgba(108, 117, 125, 0.8); /* Grey when off */
        }

        .notification-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 3px;
        }

        .toggle-indicator.on {
            background-color: #4caf50;
            box-shadow: 0 0 5px #4caf50;
        }

        .toggle-indicator.off {
            background-color: #9e9e9e;
        }

        .toggle-text {
            font-weight: 500;
        }

        .date-display {
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 50px;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 20px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-light);
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary-light);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #f57c00;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-block {
            width: 100%;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .badge {
            background-color: var(--primary-light);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-completed {
            background-color: var(--secondary) !important;
        }

        .status-cancelled {
            background-color: var(--danger-light) !important;
        }

        .status-taken {
            background-color: var(--secondary) !important;
        }

        /* Lists */
        .list-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .list-item {
            background: var(--light);
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item:hover {
            background: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }

        .list-item.medication {
            border-left-color: var(--secondary);
        }

        .item-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .item-info p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: rgba(0, 0, 0, 0.05);
            transform: scale(1.1);
        }

        .btn-icon.delete:hover {
            color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }

        .btn-icon.complete:hover {
            color: var(--secondary);
            background: rgba(102, 187, 106, 0.1);
        }

        .btn-icon.edit:hover {
            color: var(--warning);
            background: rgba(255, 152, 0, 0.1);
        }

        /* Upcoming Section */
        .upcoming-section {
            grid-column: 1 / -1;
            margin-top: 10px;
        }

        .upcoming-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .upcoming-item {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s;
        }

        .upcoming-item:hover {
            transform: translateY(-3px);
        }

        .upcoming-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .appointment-icon {
            background-color: var(--primary);
        }

        .medication-icon {
            background-color: var(--secondary);
        }

        .upcoming-info h4 {
            margin-bottom: 5px;
        }

        .upcoming-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .urgent {
            color: var(--danger);
            font-weight: 500;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray-light);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 40px;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 350px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.5s, opacity 0.5s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            background-color: var(--secondary);
        }

        .notification.info .notification-icon {
            background-color: var(--primary);
        }

        .notification.warning .notification-icon {
            background-color: var(--warning);
        }

        /* Mobile Notification Bar */
        .mobile-notification {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 999;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
        }

        .mobile-notification.show {
            transform: translateY(0);
        }

        .mobile-notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .mobile-notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .mobile-notification.appointment .mobile-notification-icon {
            background-color: var(--primary);
        }

        .mobile-notification.medication .mobile-notification-icon {
            background-color: var(--secondary);
        }

        .mobile-notification-text {
            flex: 1;
        }

        .mobile-notification-text h4 {
            font-size: 1rem;
            margin-bottom: 3px;
        }

        .mobile-notification-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .mobile-notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        /* Fixed Sample Data Button */
        .sample-data-btn {
            position: fixed;
            bottom: 80px;
            left: 20px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Edit Form Overlay */
        .edit-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            padding: 20px;
        }

        .edit-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .edit-form-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .edit-form-container h2 {
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .notification-toggle-btn {
                width: 100%;
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .item-actions {
                flex-direction: column;
            }
            
            .sample-data-btn {
                position: static;
                margin-top: 20px;
                width: 100%;
            }
            
            .edit-form-container {
                padding: 20px;
                max-height: 80vh;
            }
            
            .mobile-notification {
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 20px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-heartbeat"></i>
                    <h1>HealthTrack Pro</h1>
                </div>
                <div class="header-actions">
                    <button class="notification-toggle-btn" id="notification-toggle">
                        <i class="fas fa-bell"></i>
                        <span class="toggle-text" id="toggle-text">Notifications</span>
                        <span class="toggle-indicator" id="toggle-indicator"></span>
                    </button>
                    <div class="date-display">
                        <i class="far fa-calendar-alt"></i>
                        <span id="current-date">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Main Content -->
        <div class="main-content">
            <!-- Add Appointment Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-calendar-plus"></i> Add Appointment</h2>
                </div>
                <form id="appointment-form">
                    <div class="form-group">
                        <label for="doctor">Doctor / Specialist</label>
                        <input type="text" id="doctor" placeholder="Dr. John Smith, Cardiologist" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appointment-date">Date</label>
                            <input type="date" id="appointment-date" required>
                        </div>
                        <div class="form-group">
                            <label for="appointment-time">Time</label>
                            <input type="time" id="appointment-time" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="location">Location / Clinic</label>
                        <input type="text" id="location" placeholder="City General Hospital, Room 205">
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Notes (Optional)</label>
                        <textarea id="notes" rows="3" placeholder="Any special instructions or preparation needed"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-calendar-check"></i> Add Appointment
                    </button>
                </form>
            </div>

            <!-- Add Medication Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-pills"></i> Add Medication</h2>
                </div>
                <form id="medication-form">
                    <div class="form-group">
                        <label for="medicine">Medicine Name</label>
                        <input type="text" id="medicine" placeholder="e.g., Amoxicillin 500mg" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="medication-time">Time</label>
                            <input type="time" id="medication-time" required>
                        </div>
                        <div class="form-group">
                            <label for="frequency">Frequency</label>
                            <select id="frequency">
                                <option value="daily">Daily</option>
                                <option value="twice">Twice a day</option>
                                <option value="weekly">Weekly</option>
                                <option value="as_needed">As needed</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dosage">Dosage Instructions</label>
                        <input type="text" id="dosage" placeholder="e.g., 1 tablet with food">
                    </div>
                    
                    <button type="submit" class="btn btn-secondary btn-block">
                        <i class="fas fa-plus-circle"></i> Add Medication Schedule
                    </button>
                </form>
            </div>

            <!-- Appointments List -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-calendar-alt"></i> Upcoming Appointments</h2>
                    <span class="badge" id="appointment-count">0</span>
                </div>
                <div class="list-container" id="appointments-list">
                    <!-- Appointments will be dynamically added here -->
                    <div class="empty-state">
                        <i class="far fa-calendar-times"></i>
                        <p>No appointments scheduled. Add one above!</p>
                    </div>
                </div>
            </div>

            <!-- Medications List -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-prescription-bottle-alt"></i> Medication Schedule</h2>
                    <span class="badge" id="medication-count">0</span>
                </div>
                <div class="list-container" id="medications-list">
                    <!-- Medications will be dynamically added here -->
                    <div class="empty-state">
                        <i class="fas fa-pills"></i>
                        <p>No medications scheduled. Add one above!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Reminders -->
        <div class="card upcoming-section">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-bell"></i> Today's Reminders</h2>
                <button class="btn btn-warning" onclick="testNotifications()">
                    <i class="fas fa-bell"></i> Test Notifications
                </button>
            </div>
            <div class="upcoming-container" id="upcoming-reminders">
                <!-- Today's reminders will be dynamically added here -->
                <div class="empty-state">
                    <i class="far fa-bell-slash"></i>
                    <p>No reminders for today. Add appointments or medications to see reminders here.</p>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="card upcoming-section">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-history"></i> History</h2>
                <button class="btn btn-danger" onclick="clearAllData()">
                    <i class="fas fa-trash"></i> Clear All Data
                </button>
            </div>
            <div class="list-container" id="history-list">
                <!-- History items will be dynamically added here -->
                <div class="empty-state">
                    <i class="far fa-clock"></i>
                    <p>No history yet. Complete appointments or medications to see history here.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>HealthTrack Pro &copy; 2023 | Your Personal Healthcare Assistant</p>
            <p>Data is saved locally in your browser. Clearing browser data will remove your saved information.</p>
        </div>
    </footer>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="notification-content">
            <h4>Success!</h4>
            <p id="notification-message">Your item has been added successfully.</p>
        </div>
        <button class="btn-icon" id="close-notification">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Mobile Notification Bar -->
    <div class="mobile-notification" id="mobile-notification">
        <div class="mobile-notification-content">
            <div class="mobile-notification-icon">
                <i class="fas fa-bell"></i>
            </div>
            <div class="mobile-notification-text">
                <h4 id="mobile-notification-title">Reminder</h4>
                <p id="mobile-notification-message">You have an upcoming appointment</p>
            </div>
        </div>
        <button class="mobile-notification-close" id="close-mobile-notification">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Edit Appointment Overlay -->
    <div class="edit-overlay" id="edit-appointment-overlay">
        <div class="edit-form-container">
            <h2><i class="fas fa-edit"></i> Edit Appointment</h2>
            <form id="edit-appointment-form">
                <div class="form-group">
                    <label for="edit-doctor">Doctor / Specialist</label>
                    <input type="text" id="edit-doctor" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-appointment-date">Date</label>
                        <input type="date" id="edit-appointment-date" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-appointment-time">Time</label>
                        <input type="time" id="edit-appointment-time" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-location">Location / Clinic</label>
                    <input type="text" id="edit-location">
                </div>
                
                <div class="form-group">
                    <label for="edit-notes">Notes (Optional)</label>
                    <textarea id="edit-notes" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditForm()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sample Data Button -->
    <button class="btn btn-primary sample-data-btn" id="sample-data-btn">
        <i class="fas fa-vial"></i> Load Sample Data
    </button>

    <script>
        // Initialize data arrays
        let appointments = [];
        let medications = [];
        let history = [];
        let editingAppointmentId = null;
        let notificationSound = null;
        let notificationsEnabled = true; // Default to enabled

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const now = new Date();
            document.getElementById('current-date').textContent = formatDate(now);
            
            // Set min date to today for appointment date
            const dateInput = document.getElementById('appointment-date');
            const editDateInput = document.getElementById('edit-appointment-date');
            dateInput.min = now.toISOString().split('T')[0];
            editDateInput.min = now.toISOString().split('T')[0];
            
            // Load data from localStorage
            loadFromStorage();
            
            // Load notification setting
            loadNotificationSetting();
            
            // Set up form submissions
            document.getElementById('appointment-form').addEventListener('submit', addAppointment);
            document.getElementById('medication-form').addEventListener('submit', addMedication);
            document.getElementById('edit-appointment-form').addEventListener('submit', saveEditedAppointment);
            
            // Set up notification close buttons
            document.getElementById('close-notification').addEventListener('click', hideNotification);
            document.getElementById('close-mobile-notification').addEventListener('click', hideMobileNotification);
            
            // Set up sample data button
            document.getElementById('sample-data-btn').addEventListener('click', loadSampleData);
            
            // Set up notification toggle
            document.getElementById('notification-toggle').addEventListener('click', toggleNotificationSetting);
            
            // Initialize reminder checker (check every minute)
            setInterval(checkReminders, 60000);
            
            // Check reminders immediately on load
            setTimeout(checkReminders, 2000);
            
            // Initialize notification sound
            try {
                notificationSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
                notificationSound.volume = 0.3;
            } catch (e) {
                console.log('Audio not supported');
            }
            
            // Update notification status display
            updateNotificationUI();
        });

        // Format date as "Monday, January 1, 2023"
        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Format time to 12-hour format
        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const formattedHour = hour % 12 || 12;
            return `${formattedHour}:${minutes} ${ampm}`;
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationIcon = notification.querySelector('.notification-icon i');
            const notificationMessage = document.getElementById('notification-message');
            
            // Set notification content
            notificationMessage.textContent = message;
            
            // Set notification type
            notification.className = `notification ${type}`;
            if (type === 'success') {
                notificationIcon.className = 'fas fa-check';
            } else if (type === 'warning') {
                notificationIcon.className = 'fas fa-exclamation-triangle';
            } else {
                notificationIcon.className = 'fas fa-info-circle';
            }
            
            // Show notification
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(hideNotification, 5000);
        }

        // Hide notification
        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // Show mobile notification
        function showMobileNotification(title, message, type = 'appointment') {
            // Don't show if notifications are disabled
            if (!notificationsEnabled) return;
            
            const mobileNotification = document.getElementById('mobile-notification');
            const notificationTitle = document.getElementById('mobile-notification-title');
            const notificationMessage = document.getElementById('mobile-notification-message');
            const notificationIcon = mobileNotification.querySelector('.mobile-notification-icon i');
            
            // Set notification content
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Set notification type and icon
            mobileNotification.className = `mobile-notification ${type} show`;
            if (type === 'appointment') {
                notificationIcon.className = 'fas fa-user-md';
            } else {
                notificationIcon.className = 'fas fa-pills';
            }
            
            // Play notification sound if available
            if (notificationSound && notificationsEnabled) {
                notificationSound.currentTime = 0;
                notificationSound.play().catch(e => console.log('Could not play sound'));
            }
            
            // Vibrate if on mobile (if supported)
            if ('vibrate' in navigator && notificationsEnabled) {
                navigator.vibrate([200, 100, 200]);
            }
            
            // Auto hide after 10 seconds
            setTimeout(hideMobileNotification, 10000);
        }

        // Hide mobile notification
        function hideMobileNotification() {
            document.getElementById('mobile-notification').classList.remove('show');
        }

        // Load notification setting from localStorage
        function loadNotificationSetting() {
            try {
                const savedSetting = localStorage.getItem('healthtrack_notifications');
                if (savedSetting !== null) {
                    notificationsEnabled = savedSetting === 'true';
                }
            } catch (error) {
                console.error('Error loading notification setting:', error);
            }
        }

        // Save notification setting to localStorage
        function saveNotificationSetting() {
            try {
                localStorage.setItem('healthtrack_notifications', notificationsEnabled);
            } catch (error) {
                console.error('Error saving notification setting:', error);
            }
        }

        // Update notification UI based on current setting
        function updateNotificationUI() {
            const toggleBtn = document.getElementById('notification-toggle');
            const toggleText = document.getElementById('toggle-text');
            const toggleIndicator = document.getElementById('toggle-indicator');
            
            if (notificationsEnabled) {
                // Green theme - ON
                toggleBtn.classList.remove('disabled');
                toggleBtn.classList.add('enabled');
                toggleIndicator.classList.remove('off');
                toggleIndicator.classList.add('on');
                toggleText.textContent = 'Notifications ON';
                
                // Also update browser permission if needed
                if (Notification.permission === 'default') {
                    // Request permission if not yet decided
                    Notification.requestPermission();
                }
            } else {
                // Grey theme - OFF
                toggleBtn.classList.remove('enabled');
                toggleBtn.classList.add('disabled');
                toggleIndicator.classList.remove('on');
                toggleIndicator.classList.add('off');
                toggleText.textContent = 'Notifications OFF';
            }
        }

        // Toggle notification setting
        function toggleNotificationSetting() {
            notificationsEnabled = !notificationsEnabled;
            
            // Save setting
            saveNotificationSetting();
            
            // Update UI
            updateNotificationUI();
            
            // Show feedback
            if (notificationsEnabled) {
                showNotification('Notifications enabled. You will receive reminders.', 'success');
                
                // Request permission if needed
                if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'denied') {
                            showNotification('Browser notifications are blocked. Please enable them in browser settings.', 'warning');
                        }
                    });
                }
            } else {
                showNotification('Notifications disabled. You will not receive reminders.', 'info');
            }
        }

        // Save all data to localStorage
        function saveToStorage() {
            try {
                localStorage.setItem('healthtrack_appointments', JSON.stringify(appointments));
                localStorage.setItem('healthtrack_medications', JSON.stringify(medications));
                localStorage.setItem('healthtrack_history', JSON.stringify(history));
                console.log('Data saved to localStorage');
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                showNotification('Error saving data. Please try again.', 'warning');
            }
        }

        // Load all data from localStorage
        function loadFromStorage() {
            try {
                const savedAppointments = localStorage.getItem('healthtrack_appointments');
                const savedMedications = localStorage.getItem('healthtrack_medications');
                const savedHistory = localStorage.getItem('healthtrack_history');
                
                if (savedAppointments) {
                    appointments = JSON.parse(savedAppointments);
                }
                
                if (savedMedications) {
                    medications = JSON.parse(savedMedications);
                }
                
                if (savedHistory) {
                    history = JSON.parse(savedHistory);
                }
                
                console.log('Data loaded from localStorage');
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                // Keep default empty arrays if there's an error
            }
            
            // Update UI with loaded data
            renderAppointments();
            renderMedications();
            updateUpcomingReminders();
            renderHistory();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                appointments = [];
                medications = [];
                history = [];
                saveToStorage();
                renderAppointments();
                renderMedications();
                renderHistory();
                updateUpcomingReminders();
                showNotification('All data cleared successfully.', 'info');
            }
        }

        // Test notifications
        function testNotifications() {
            if (!notificationsEnabled) {
                showNotification('Notifications are currently disabled. Enable them using the toggle button.', 'warning');
                return;
            }
            
            if (Notification.permission === "granted") {
                // Test desktop notification
                showBrowserNotification('Test Notification', 'This is a test notification from HealthTrack Pro');
                
                // Test mobile notification
                showMobileNotification('Test Notification', 'This is a test reminder from HealthTrack Pro', 'appointment');
                
                showNotification('Test notifications sent! Check your device.', 'success');
            } else if (Notification.permission === "denied") {
                showNotification('Browser notifications are blocked. Please enable them in browser settings.', 'warning');
            } else {
                // Request permission
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        showBrowserNotification('Test Notification', 'This is a test notification from HealthTrack Pro');
                        showMobileNotification('Test Notification', 'This is a test reminder from HealthTrack Pro', 'appointment');
                        showNotification('Notifications enabled! Test sent.', 'success');
                    } else {
                        showNotification('Notifications not enabled. You can enable them later.', 'info');
                    }
                });
            }
        }

        // Check for upcoming reminders
        function checkReminders() {
            // Don't check if notifications are disabled
            if (!notificationsEnabled) return;
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const today = now.toISOString().split('T')[0];
            let foundReminder = false;
            
            // Check appointments for today
            appointments.forEach(appointment => {
                if (appointment.date === today && appointment.status === 'scheduled') {
                    const [hours, minutes] = appointment.time.split(':');
                    const appointmentTime = parseInt(hours) * 60 + parseInt(minutes);
                    const timeDiff = appointmentTime - currentTime;
                    
                    // Notify 30 minutes before appointment
                    if (timeDiff > 0 && timeDiff <= 30 && !appointment.notified) {
                        showBrowserNotification(`Upcoming Appointment`, 
                            `You have an appointment with ${appointment.doctor} at ${formatTime(appointment.time)}`);
                        
                        showMobileNotification(`Appointment Reminder`, 
                            `With ${appointment.doctor} at ${formatTime(appointment.time)}`, 'appointment');
                        
                        appointment.notified = true;
                        foundReminder = true;
                        saveToStorage();
                    }
                    
                    // Notify again 5 minutes before
                    if (timeDiff > 0 && timeDiff <= 5 && !appointment.notified5min) {
                        showBrowserNotification(`Appointment Soon`, 
                            `Your appointment with ${appointment.doctor} is in 5 minutes`);
                        
                        showMobileNotification(`Appointment Soon`, 
                            `With ${appointment.doctor} in 5 minutes`, 'appointment');
                        
                        appointment.notified5min = true;
                        foundReminder = true;
                        saveToStorage();
                    }
                }
            });
            
            // Check medications for today
            medications.forEach(medication => {
                if (medication.status === 'active') {
                    const [hours, minutes] = medication.time.split(':');
                    const medicationTime = parseInt(hours) * 60 + parseInt(minutes);
                    const timeDiff = medicationTime - currentTime;
                    
                    // Notify at medication time (Â±2 minutes)
                    if (timeDiff >= 0 && timeDiff <= 2 && !medication.notifiedToday) {
                        showBrowserNotification(`Medication Time`, 
                            `Time to take ${medication.name} - ${medication.dosage}`);
                        
                        showMobileNotification(`Medication Reminder`, 
                            `Take ${medication.name} - ${medication.dosage}`, 'medication');
                        
                        medication.notifiedToday = true;
                        foundReminder = true;
                        saveToStorage();
                    }
                }
            });
            
            // Reset daily notifications at midnight
            if (now.getHours() === 0 && now.getMinutes() === 0) {
                medications.forEach(m => m.notifiedToday = false);
                appointments.forEach(a => {
                    a.notified = false;
                    a.notified5min = false;
                });
                saveToStorage();
            }
            
            return foundReminder;
        }

        // Show browser notification
        function showBrowserNotification(title, message) {
            // Don't show if notifications are disabled
            if (!notificationsEnabled) return;
            
            // Check if browser supports notifications
            if (!("Notification" in window)) {
                console.log("This browser does not support desktop notification");
                return;
            }
            
            // Check if permission is already granted
            if (Notification.permission === "granted") {
                const notification = new Notification(title, {
                    body: message,
                    icon: 'https://cdn-icons-png.flaticon.com/512/2917/2917633.png',
                    tag: 'healthtrack-reminder',
                    requireInteraction: true
                });
                
                // Handle notification click
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
                
                // Auto close after 10 seconds
                setTimeout(() => notification.close(), 10000);
            } 
            // Otherwise, request permission
            else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        const notification = new Notification(title, {
                            body: message,
                            icon: 'https://cdn-icons-png.flaticon.com/512/2917/2917633.png'
                        });
                        
                        // Auto close after 10 seconds
                        setTimeout(() => notification.close(), 10000);
                    }
                });
            }
        }

        // Add appointment
        function addAppointment(e) {
            e.preventDefault();
            
            const doctor = document.getElementById('doctor').value;
            const date = document.getElementById('appointment-date').value;
            const time = document.getElementById('appointment-time').value;
            const location = document.getElementById('location').value;
            const notes = document.getElementById('notes').value;
            
            // Validate date is not in the past
            const selectedDate = new Date(date + 'T' + time);
            if (selectedDate < new Date()) {
                showNotification('Cannot schedule appointments in the past. Please select a future date/time.', 'warning');
                return;
            }
            
            // Generate a unique ID
            const id = appointments.length > 0 ? Math.max(...appointments.map(a => a.id)) + 1 : 1;
            
            // Add to appointments array
            appointments.push({
                id,
                doctor,
                date,
                time,
                location,
                notes,
                status: 'scheduled',
                added: new Date().toISOString(),
                notified: false,
                notified5min: false
            });
            
            // Save to localStorage
            saveToStorage();
            
            // Reset form
            document.getElementById('appointment-form').reset();
            
            // Update UI
            renderAppointments();
            updateUpcomingReminders();
            
            // Show success notification
            showNotification(`Appointment with ${doctor} scheduled successfully!`, 'success');
        }

        // Add medication
        function addMedication(e) {
            e.preventDefault();
            
            const name = document.getElementById('medicine').value;
            const time = document.getElementById('medication-time').value;
            const frequency = document.getElementById('frequency').value;
            const dosage = document.getElementById('dosage').value;
            
            // Generate a unique ID
            const id = medications.length > 0 ? Math.max(...medications.map(m => m.id)) + 1 : 1;
            
            // Add to medications array
            medications.push({
                id,
                name,
                time,
                frequency,
                dosage,
                status: 'active',
                added: new Date().toISOString(),
                notifiedToday: false
            });
            
            // Save to localStorage
            saveToStorage();
            
            // Reset form
            document.getElementById('medication-form').reset();
            
            // Update UI
            renderMedications();
            updateUpcomingReminders();
            
            // Show success notification
            showNotification(`${name} added to your medication schedule!`, 'success');
        }

        // Open edit appointment form
        function openEditAppointment(id) {
            const appointment = appointments.find(a => a.id === id);
            if (!appointment) return;
            
            editingAppointmentId = id;
            
            // Fill form with appointment data
            document.getElementById('edit-doctor').value = appointment.doctor;
            document.getElementById('edit-appointment-date').value = appointment.date;
            document.getElementById('edit-appointment-time').value = appointment.time;
            document.getElementById('edit-location').value = appointment.location || '';
            document.getElementById('edit-notes').value = appointment.notes || '';
            
            // Show overlay
            document.getElementById('edit-appointment-overlay').classList.add('show');
        }

        // Close edit form
        function closeEditForm() {
            editingAppointmentId = null;
            document.getElementById('edit-appointment-overlay').classList.remove('show');
            document.getElementById('edit-appointment-form').reset();
        }

        // Save edited appointment
        function saveEditedAppointment(e) {
            e.preventDefault();
            
            if (!editingAppointmentId) return;
            
            const doctor = document.getElementById('edit-doctor').value;
            const date = document.getElementById('edit-appointment-date').value;
            const time = document.getElementById('edit-appointment-time').value;
            const location = document.getElementById('edit-location').value;
            const notes = document.getElementById('edit-notes').value;
            
            // Validate date is not in the past
            const selectedDate = new Date(date + 'T' + time);
            if (selectedDate < new Date()) {
                showNotification('Cannot schedule appointments in the past. Please select a future date/time.', 'warning');
                return;
            }
            
            // Find and update appointment
            const appointmentIndex = appointments.findIndex(a => a.id === editingAppointmentId);
            if (appointmentIndex !== -1) {
                appointments[appointmentIndex] = {
                    ...appointments[appointmentIndex],
                    doctor,
                    date,
                    time,
                    location,
                    notes,
                    notified: false, // Reset notifications since time/date might have changed
                    notified5min: false
                };
                
                // Save to localStorage
                saveToStorage();
                
                // Close form
                closeEditForm();
                
                // Update UI
                renderAppointments();
                updateUpcomingReminders();
                
                // Show success notification
                showNotification(`Appointment with ${doctor} updated successfully!`, 'success');
            }
        }

        // Mark appointment as completed
        function markAppointmentAsCompleted(id) {
            const appointmentIndex = appointments.findIndex(a => a.id === id);
            if (appointmentIndex !== -1) {
                const appointment = appointments[appointmentIndex];
                
                // Move to history
                history.push({
                    ...appointment,
                    status: 'completed',
                    completedAt: new Date().toISOString(),
                    type: 'appointment'
                });
                
                // Remove from active appointments
                appointments.splice(appointmentIndex, 1);
                
                saveToStorage();
                renderAppointments();
                renderHistory();
                updateUpcomingReminders();
                showNotification(`Appointment with ${appointment.doctor} marked as completed!`, 'success');
            }
        }

        // Delete appointment
        function deleteAppointment(id) {
            if (!confirm('Are you sure you want to delete this appointment?')) return;
            
            // Move to history before deleting
            const appointment = appointments.find(a => a.id === id);
            if (appointment) {
                history.push({
                    ...appointment,
                    status: 'cancelled',
                    completedAt: new Date().toISOString(),
                    type: 'appointment'
                });
            }
            
            appointments = appointments.filter(appointment => appointment.id !== id);
            saveToStorage();
            renderAppointments();
            updateUpcomingReminders();
            renderHistory();
            showNotification('Appointment deleted successfully.', 'info');
        }

        // Mark medication as taken
        function markMedicationAsTaken(id) {
            const medicationIndex = medications.findIndex(m => m.id === id);
            if (medicationIndex !== -1) {
                const medication = medications[medicationIndex];
                
                // Move to history
                history.push({
                    ...medication,
                    status: 'taken',
                    completedAt: new Date().toISOString(),
                    type: 'medication'
                });
                
                // Remove from active medications if frequency is not daily
                if (medication.frequency === 'daily') {
                    // Keep in active list for daily medications
                    medications[medicationIndex].lastTaken = new Date().toISOString();
                } else {
                    // Remove for non-daily medications
                    medications.splice(medicationIndex, 1);
                }
                
                saveToStorage();
                renderMedications();
                renderHistory();
                updateUpcomingReminders();
                showNotification(`${medication.name} marked as taken!`, 'success');
            }
        }

        // Delete medication
        function deleteMedication(id) {
            if (!confirm('Are you sure you want to delete this medication?')) return;
            
            // Move to history before deleting
            const medication = medications.find(m => m.id === id);
            if (medication) {
                history.push({
                    ...medication,
                    status: 'cancelled',
                    completedAt: new Date().toISOString(),
                    type: 'medication'
                });
            }
            
            medications = medications.filter(medication => medication.id !== id);
            saveToStorage();
            renderMedications();
            updateUpcomingReminders();
            renderHistory();
            showNotification('Medication deleted from schedule.', 'info');
        }

        // Render appointments list
        function renderAppointments() {
            const appointmentsList = document.getElementById('appointments-list');
            const appointmentCount = document.getElementById('appointment-count');
            
            // Filter only scheduled appointments
            const scheduledAppointments = appointments.filter(a => a.status === 'scheduled');
            
            // Update count
            appointmentCount.textContent = scheduledAppointments.length;
            
            if (scheduledAppointments.length === 0) {
                appointmentsList.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-calendar-times"></i>
                        <p>No appointments scheduled. Add one above!</p>
                    </div>
                `;
                return;
            }
            
            // Sort appointments by date and time
            scheduledAppointments.sort((a, b) => {
                const dateA = new Date(`${a.date}T${a.time}`);
                const dateB = new Date(`${b.date}T${b.time}`);
                return dateA - dateB;
            });
            
            // Generate appointments HTML
            appointmentsList.innerHTML = scheduledAppointments.map(appointment => {
                const appointmentDate = new Date(appointment.date);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                let dateDisplay;
                if (appointment.date === today.toISOString().split('T')[0]) {
                    dateDisplay = 'Today';
                } else if (appointment.date === tomorrow.toISOString().split('T')[0]) {
                    dateDisplay = 'Tomorrow';
                } else {
                    dateDisplay = appointmentDate.toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                }
                
                return `
                    <div class="list-item">
                        <div class="item-info">
                            <h4>${appointment.doctor}</h4>
                            <p><i class="far fa-calendar"></i> ${dateDisplay} at ${formatTime(appointment.time)}</p>
                            ${appointment.location ? `<p><i class="fas fa-map-marker-alt"></i> ${appointment.location}</p>` : ''}
                            ${appointment.notes ? `<p><i class="far fa-sticky-note"></i> ${appointment.notes}</p>` : ''}
                        </div>
                        <div class="item-actions">
                            <button class="btn-icon edit" onclick="openEditAppointment(${appointment.id})" title="Edit appointment">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon complete" onclick="markAppointmentAsCompleted(${appointment.id})" title="Mark as completed">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon delete" onclick="deleteAppointment(${appointment.id})" title="Delete appointment">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render medications list
        function renderMedications() {
            const medicationsList = document.getElementById('medications-list');
            const medicationCount = document.getElementById('medication-count');
            
            // Filter only active medications
            const activeMedications = medications.filter(m => m.status === 'active');
            
            // Update count
            medicationCount.textContent = activeMedications.length;
            
            if (activeMedications.length === 0) {
                medicationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-pills"></i>
                        <p>No medications scheduled. Add one above!</p>
                    </div>
                `;
                return;
            }
            
            // Sort medications by time
            activeMedications.sort((a, b) => {
                const timeA = a.time.replace(':', '');
                const timeB = b.time.replace(':', '');
                return timeA - timeB;
            });
            
            // Generate medications HTML
            medicationsList.innerHTML = activeMedications.map(medication => {
                const frequencyMap = {
                    'daily': 'Daily',
                    'twice': 'Twice a day',
                    'weekly': 'Weekly',
                    'as_needed': 'As needed'
                };
                
                return `
                    <div class="list-item medication">
                        <div class="item-info">
                            <h4>${medication.name}</h4>
                            <p><i class="far fa-clock"></i> ${formatTime(medication.time)} â¢ ${frequencyMap[medication.frequency]}</p>
                            ${medication.dosage ? `<p><i class="fas fa-exclamation-circle"></i> ${medication.dosage}</p>` : ''}
                        </div>
                        <div class="item-actions">
                            <button class="btn-icon complete" onclick="markMedicationAsTaken(${medication.id})" title="Mark as taken">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon delete" onclick="deleteMedication(${medication.id})" title="Delete medication">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update upcoming reminders for today
        function updateUpcomingReminders() {
            const upcomingReminders = document.getElementById('upcoming-reminders');
            const today = new Date().toISOString().split('T')[0];
            
            // Filter today's appointments
            const todaysAppointments = appointments.filter(appointment => 
                appointment.date === today && appointment.status === 'scheduled'
            );
            
            // Filter today's medications
            const todaysMedications = medications.filter(medication => 
                medication.status === 'active'
            );
            
            // Combine and sort by time
            const allReminders = [
                ...todaysAppointments.map(a => ({...a, type: 'appointment'})),
                ...todaysMedications.map(m => ({...m, type: 'medication'}))
            ].sort((a, b) => {
                const timeA = a.time.replace(':', '');
                const timeB = b.time.replace(':', '');
                return timeA - timeB;
            });
            
            if (allReminders.length === 0) {
                upcomingReminders.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-bell-slash"></i>
                        <p>No reminders for today. Add appointments or medications to see reminders here.</p>
                    </div>
                `;
                return;
            }
            
            // Generate reminders HTML
            upcomingReminders.innerHTML = allReminders.map(reminder => {
                const timeDisplay = formatTime(reminder.time);
                const now = new Date();
                const [hours, minutes] = reminder.time.split(':');
                const reminderTime = new Date();
                reminderTime.setHours(parseInt(hours), parseInt(minutes), 0);
                
                const isUpcoming = reminderTime > now;
                const timeDiff = reminderTime - now;
                const minutesUntil = Math.floor(timeDiff / (1000 * 60));
                
                let timeText = '';
                if (minutesUntil > 0 && minutesUntil <= 60) {
                    timeText = `in ${minutesUntil} minutes`;
                } else if (minutesUntil > 60) {
                    const hoursUntil = Math.floor(minutesUntil / 60);
                    timeText = `in ${hoursUntil} hour${hoursUntil > 1 ? 's' : ''}`;
                } else if (minutesUntil < 0) {
                    timeText = `${Math.abs(minutesUntil)} minutes ago`;
                }
                
                if (reminder.type === 'appointment') {
                    return `
                        <div class="upcoming-item">
                            <div class="upcoming-icon appointment-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="upcoming-info">
                                <h4>Appointment with ${reminder.doctor}</h4>
                                <p><i class="far fa-clock"></i> ${timeDisplay} ${timeText ? `(${timeText})` : ''}</p>
                                ${reminder.location ? `<p><i class="fas fa-map-marker-alt"></i> ${reminder.location}</p>` : ''}
                                ${isUpcoming ? `<p class="urgent"><i class="fas fa-bell"></i> Upcoming</p>` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="upcoming-item">
                            <div class="upcoming-icon medication-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="upcoming-info">
                                <h4>${reminder.name}</h4>
                                <p><i class="far fa-clock"></i> ${timeDisplay} ${timeText ? `(${timeText})` : ''} â¢ ${reminder.dosage}</p>
                                ${isUpcoming ? `<p class="urgent"><i class="fas fa-bell"></i> Upcoming</p>` : ''}
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Render history list
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-clock"></i>
                        <p>No history yet. Complete appointments or medications to see history here.</p>
                    </div>
                `;
                return;
            }
            
            // Sort history by completion date (newest first)
            history.sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
            
            // Generate history HTML
            historyList.innerHTML = history.map(item => {
                const completedDate = new Date(item.completedAt);
                const formattedDate = completedDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusClass = `status-${item.status}`;
                const statusText = item.status === 'completed' ? 'Completed' : 
                                  item.status === 'taken' ? 'Taken' : 'Cancelled';
                
                if (item.type === 'appointment') {
                    return `
                        <div class="list-item" style="border-left-color: var(--primary-dark); opacity: 0.9;">
                            <div class="item-info">
                                <h4>${item.doctor} <span class="badge ${statusClass}" style="font-size: 0.7rem; padding: 2px 8px;">${statusText}</span></h4>
                                <p><i class="far fa-calendar"></i> ${item.date} at ${formatTime(item.time)}</p>
                                ${item.location ? `<p><i class="fas fa-map-marker-alt"></i> ${item.location}</p>` : ''}
                                <p><i class="far fa-clock"></i> ${formattedDate}</p>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="list-item medication" style="border-left-color: var(--secondary-dark); opacity: 0.9;">
                            <div class="item-info">
                                <h4>${item.name} <span class="badge ${statusClass}" style="font-size: 0.7rem; padding: 2px 8px;">${statusText}</span></h4>
                                <p><i class="far fa-clock"></i> ${formatTime(item.time)} â¢ ${item.dosage}</p>
                                <p><i class="far fa-clock"></i> ${formattedDate}</p>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Load sample data for demonstration
        function loadSampleData() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            // Add sample appointments
            const sampleAppointments = [
                { 
                    id: appointments.length > 0 ? Math.max(...appointments.map(a => a.id)) + 1 : 1,
                    doctor: "Dr. Sarah Johnson", 
                    date: tomorrow.toISOString().split('T')[0], 
                    time: "14:30", 
                    location: "City General Hospital, Room 305", 
                    notes: "Annual physical checkup",
                    status: 'scheduled',
                    added: new Date().toISOString(),
                    notified: false,
                    notified5min: false
                },
                { 
                    id: appointments.length > 0 ? Math.max(...appointments.map(a => a.id)) + 2 : 2,
                    doctor: "Dr. Michael Chen", 
                    date: nextWeek.toISOString().split('T')[0], 
                    time: "10:00", 
                    location: "Dental Care Clinic", 
                    notes: "Root canal treatment follow-up",
                    status: 'scheduled',
                    added: new Date().toISOString(),
                    notified: false,
                    notified5min: false
                }
            ];
            
            // Add sample medications
            const sampleMedications = [
                { 
                    id: medications.length > 0 ? Math.max(...medications.map(m => m.id)) + 1 : 1,
                    name: "Amoxicillin 500mg", 
                    time: "09:00", 
                    frequency: "twice", 
                    dosage: "1 tablet with food", 
                    status: 'active',
                    added: new Date().toISOString(),
                    notifiedToday: false
                },
                { 
                    id: medications.length > 0 ? Math.max(...medications.map(m => m.id)) + 2 : 2,
                    name: "Vitamin D3 1000IU", 
                    time: "13:00", 
                    frequency: "daily", 
                    dosage: "1 capsule after lunch", 
                    status: 'active',
                    added: new Date().toISOString(),
                    notifiedToday: false
                }
            ];
            
            // Add to arrays
            appointments.push(...sampleAppointments);
            medications.push(...sampleMedications);
            
            // Save to localStorage
            saveToStorage();
            
            // Update UI
            renderAppointments();
            renderMedications();
            updateUpcomingReminders();
            renderHistory();
            
            // Show notification
            showNotification('Sample data loaded successfully!', 'success');
        }
    </script>
</body>
</html>